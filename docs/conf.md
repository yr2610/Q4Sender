# conf.yaml 設定ガイド

`conf.yaml` は Q4Sender の QR コード生成に関する設定を行うためのファイルです。実行ファイル (`Q4Sender.exe`) と同じディレクトリに配置すると、起動時に自動で読み込まれます。ファイルが存在しない、あるいは設定値が省略された場合は、組み込みの既定値が利用されます。

## ファイル構造

最上位に `timerInterval` と `qrSettings` を配置できます。`timerInterval` は省略可能で、フレーム更新間隔（ミリ秒）を指定します。`qrSettings` オブジェクトの下に誤り訂正レベルとバージョンを指定します。

```yaml
timerInterval: 125         # QR 切り替え間隔（ミリ秒）。省略時は 125ms
qrSettings:
  errorCorrectionLevel: Q  # L / M / Q / H のいずれか（省略時は Q）
  version: 5               # 1〜40 の整数。省略または null で自動判定
```

各項目の意味は次の通りです。

| キー | 型 | 説明 |
| ---- | -- | ---- |
| `timerInterval` | 整数 | QR コードを表示する更新間隔（ミリ秒）です。`1` 以上の整数を指定してください。省略または無効な値の場合は 125ms が使用されます。 |
| `qrSettings.errorCorrectionLevel` | 文字列 | QR コードの誤り訂正レベルを指定します。`L`、`M`、`Q`、`H` のいずれか（大文字・小文字は不問）を入力してください。不正な値を指定した場合は読み込み時に警告が表示され、既定値 `Q` に戻ります。 |
| `qrSettings.version` | 整数または `null` | QR コードのバージョン（サイズ）を明示的に指定します。`1`〜`40` の範囲で入力します。値を省略するか `null` を指定すると自動的に最適なサイズが選択されます。負の値や 0 など無効な値は無視され、自動判定になります。 |

誤り訂正レベルとバージョンの組み合わせに応じて、アプリ側で 1 枚あたりのペイロード長を自動調整します。指定したバージョンでデータを収容できない場合は警告を表示し、QR のサイズを自動判定に戻した上で再生成します。

## 例

### 最小構成

誤り訂正レベルのみを設定する最小構成例です。バージョンは自動判定、タイマー間隔は既定値になります。

```yaml
qrSettings:
  errorCorrectionLevel: M
```

### 自動判定を明示

`version` を `null` と明記することで、他の項目を残したまま自動判定にできます。`timerInterval` を併用すると切り替え速度も調整できます。

```yaml
timerInterval: 100
qrSettings:
  errorCorrectionLevel: H
  version: null
```

### Windows 以外での注意

`AppConfig.Load` は UTF-8 (BOM なし) の YAML を想定しています。別のエンコーディングで保存した場合は読み込みに失敗する可能性があるため、UTF-8 で保存してください。

## 既定値

`conf.yaml` が存在しない場合、あるいは設定が無効で読み込めなかった場合は、以下の既定値が使用されます。

- タイマー間隔: `125` ミリ秒
- 誤り訂正レベル: `Q`
- QR バージョン: 自動判定（`null`）

これらの値はアプリケーション起動時にコンソール出力は行いませんが、内部的に適用されています。
